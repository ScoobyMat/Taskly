@if (editTask) {
<form #form="ngForm" (ngSubmit)="updateTask(form)"
  class="max-w-xl mx-auto p-6 bg-base-100 rounded-lg shadow-md space-y-6" novalidate>

  <div>
    <button (click)="cancel()" type="button" class="btn btn-ghost btn-secondary">
      <i class="fa-solid fa-circle-left"></i>
    </button>
  </div>

  <h2 class="text-center text-3xl font-bold mb-6">Edytuj zadanie</h2>

  <div class="form-control w-full">
    <label for="title" class="label"><span class="label-text font-medium">Tytuł</span></label>
    <input id="title" name="title" type="text" [(ngModel)]="editTask.title" #titleCtrl="ngModel" required minlength="3"
      class="input input-bordered w-full" />
    <div class="text-error text-sm mt-1">
      @if (titleCtrl.invalid && (titleCtrl.dirty || titleCtrl.touched)) {
      @if (titleCtrl.errors?.['required']) { <span>Tytuł jest wymagany.</span> }
      @if (titleCtrl.errors?.['minlength']) { <span>Minimum 3 znaki.</span> }
      }
    </div>
  </div>

  <div class="form-control w-full">
    <label for="description" class="label"><span class="label-text font-medium">Opis</span></label>
    <textarea id="description" name="description" rows="4" [(ngModel)]="editTask.description" #descCtrl="ngModel"
      maxlength="1000" class="textarea textarea-bordered w-full resize-none"></textarea>
    <div class="text-error text-sm mt-1">
      @if (descCtrl.errors?.['maxlength']) { <span>Maksymalnie 1000 znaków.</span> }
    </div>
  </div>

  <div class="form-control w-full">
    <label for="status" class="label"><span class="label-text font-medium">Status</span></label>
    <select id="status" name="status" [(ngModel)]="editTask.status" #statusCtrl="ngModel" required
      class="select select-bordered w-full">
      @for (s of taskStatuses; track s) {
      <option [ngValue]="s">{{ TaskStatusLabels[s] }}</option>
      }
    </select>
    <div class="text-error text-sm mt-1">
      @if (statusCtrl.invalid && (statusCtrl.dirty || statusCtrl.touched)) {
      <span>Status jest wymagany.</span>
      }
    </div>
  </div>

  <div class="form-control w-full">
    <label for="priority" class="label"><span class="label-text font-medium">Priorytet</span></label>
    <select id="priority" name="priority" [(ngModel)]="editTask.priority" class="select select-bordered w-full">
      <option [ngValue]="null">Brak</option>
      @for (p of taskPriorities; track p) {
      <option [ngValue]="p">{{ TaskPriorityLabels[p] }}</option>
      }
    </select>
  </div>

  <div class="form-control w-full">
    <label for="dueDate" class="label"><span class="label-text font-medium">Termin wykonania</span></label>
    <input id="dueDate" name="dueDate" type="date" [(ngModel)]="editTask.dueDate" [min]="today"
      class="input input-bordered w-full" />
  </div>

  <div class="form-control w-full">
    <label for="category" class="label"><span class="label-text font-medium">Kategoria</span></label>
    <select id="category" name="category" [(ngModel)]="editTask.category" #catCtrl="ngModel" required
      class="select select-bordered w-full">
      <option [ngValue]="''" disabled>Wybierz kategorię</option>
      @for (category of categories(); track category) {
      <option [ngValue]="category">{{ category }}</option>
      }
    </select>
    <div class="text-error text-sm mt-1">
      @if (catCtrl.invalid && (catCtrl.dirty || catCtrl.touched)) {
      <span>Kategoria jest wymagana.</span>
      }
    </div>
  </div>

  <button type="submit" class="btn btn-primary w-full" [disabled]="form.invalid || isSubmitting">
    {{ isSubmitting ? 'Zapisywanie…' : 'Zapisz zmiany' }}
  </button>
</form>
} @else {
<p class="text-center text-gray-500">Ładowanie zadania...</p>
}
